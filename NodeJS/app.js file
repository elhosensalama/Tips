app.js
 ** Ø¯Ù‡ Ø§ÙˆÙ„ Ù…Ù„Ù 
 
 1 - Ø¨Ø³ØªØ¯Ø¹ÙŠ ÙÙŠÙ‡ Ø§Ù„ Express Ùˆ Morgan Ùˆ path. ğŸ‘‡

const express = require('express');
const morgan = require('morgan');
const path = require('path');

 2 - Ø¨Ø³ØªØ¯Ø¹ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…ÙƒØ§ØªØ¨ Ø¹Ù„Ø´Ø§Ù† Ø§Ù„ security. ğŸ‘‡

const rateLimit = require('express-rate-limit');
	=> Ø¯ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø­Ø¯Ø¯ Ø¹Ø¯Ø¯ Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„ requests Ø¹Ù„ÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
	
const helmet = require('helmet');
	=> Ø¯ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø®Ù„ÙŠ Ø§Ù„ http headers ØªÙƒÙˆÙ† Ù…Ø­Ù…ÙŠØ©
	
const xss = require('xss-clean');
	=> Ø¯ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø¹Ù…Ù„ ÙÙ„ØªØ±Ù‡ Ø¶Ø¯ Ø§ÙŠ Ù‡Ø¬ÙˆÙ… XSS
	
const mongoSanitize = require('express-mongo-sanitize');
	=> Ø¯ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø¹Ù…Ù„ ÙÙ„ØªØ±Ø© Ø¶Ø¯ Ø§ÙŠ Ù‡Ø¬ÙˆÙ… NoSQL query injection
	
const hpp = require('hpp');
	=> Ø¯ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø­Ø¯Ø¯ Ø¹Ø¯Ø¯ Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù Ø§Ù„ url
	
const cookieParser = require('cookie-parser');
	=> Ø¯ÙŠ Ø¹Ù„Ø´Ø§Ù† Ø§Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„ cookies Ù…Ù† Ø§Ù„ browser

 3 - Ø¨Ø³ØªØ¯Ø¹ÙŠ Ø§Ù„ AppError Ùˆ Ø§Ù„ errorHandler Ùˆ Ø§Ù„ Routers. ğŸ‘‡

const AppError = require('./utils/appError');
const errorHandler = require('./controllers/errorController');
const tourRouter = require('./routes/tourRoutes');

 4 - Ø¨Ø¹Ù…Ù„ Ø§Ù„Ø§Ø¨Ù„ÙƒÙŠØ´Ù† Ù…Ù† Ø§Ù„ express. ğŸ‘‡
const app = express();

 5 - Ø¨Ø¨Ø¯Ø§ Ø§Ø¹Ø±Ù express Ø§Ù† Ù‡Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… pug Ùƒ templete engine. ğŸ‘‡
 
app.set('view engine', 'pug');
app.set('views', path.join(__dirname, 'views'));

 ** Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ GLOBAL Middlewares. ğŸ‘‡

 6 - Ø¨Ø¨Ø¯Ø§ Ø§Ø´ØºÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„ front Ø§Ù„ Ù‡ÙŠ static Ù Ù…Ù„Ù Ø§Ù„ public. ğŸ‘‡ 
app.use(express.static(path.join(__dirname, 'public')));

 7 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… helmet Ùƒ middleware. ğŸ‘‡
app.use(helmet());

 8 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… morgan Ù Ø­Ø§Ù„Ù‡ Ø§Ù„ development. ğŸ‘‡
if (process.env.NODE_ENV === 'development') {
    app.use(morgan('dev'));
}
 9 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… rateLimit Ùˆ Ø§Ø®Ù„ÙŠÙ‡ Ù…Ø«Ù„Ø§ 100 request Ù„ÙƒÙ„ Ø³Ø§Ø¹Ù‡. ğŸ‘‡
const limiter = rateLimit({
    max: 100,
    windowMs: 60 * 60 * 1000,
    message: 'Too many requests from this IP , try again after 1 hour',
});

app.use('/api', limiter);

 10 - Ø¨Ø¨Ø¯Ø§ Ø§Ø¹Ù…Ù„ parsing Ù„Ù„ data Ø³ÙˆØ§Ø¡ json Ø§Ùˆ cookies. ğŸ‘‡
app.use(express.json({ limit: '10kb' }));
app.use(cookieParser());
* Ù„Ù…Ø§ Ø¨Ø¹Ù…Ù„ parse json Ø§Ù„Ø¯Ø§ØªØ§ Ø¨Ø¨ØªØ®Ø²Ù† Ù Ø§Ù„ req.body
* Ù„Ù…Ø§ Ø¨Ø¹Ù…Ù„ parse cookie Ø§Ù„Ø¯Ø§ØªØ§ Ø¨Ø¨ØªØ®Ø²Ù† Ù Ø§Ù„ res.cookie

 11 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… mongoSanitize Ùƒ middleware. ğŸ‘‡
app.use(mongoSanitize());

 12 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… xss Ùƒ middleware. ğŸ‘‡
app.use(xss());

13 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… hpp Ùƒ middleware ÙˆØ§Ø­Ø¯Ø¯ Ù„Ù‡ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨ÙŠÙ‡Ø§. ğŸ‘‡

app.use(
    hpp({
        whitelist: [
            'duration',
            'ratingQuantity',
            'ratingAverage',
            'maxGroupSize',
            'price',
            'difficulty',
        ],
    })
);
15 - Ø§Ù‚Ø¯Ø± Ø§Ø¹Ù…Ù„ middleware Ùƒ test. ğŸ‘‡

app.use((req, res, next) => {
    // console.log('hello from the middleware 1');
    req.requestTime = new Date().toISOString();
    next();
});

16 - Ø¨Ø¨Ø¯Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ Routes Ø§Ù„ Ø§Ø³ØªØ¯Ø¹ÙŠØªÙ‡Ø§ Ùˆ Ø§Ø­Ø¯Ø¯ Ù„Ù‡Ø§ Ø±ÙˆØª Ù…Ø¹ÙŠÙ†. ğŸ‘‡

app.use('/', viewRouter);
app.use('/api/v1/tours', tourRouter);
app.use('/api/v1/users', userRouter);

17 - Ø¨Ø¹Ù…Ù„ middleware ÙŠØ·Ù„Ø¹ Ø§ÙŠØ±ÙˆØ± Ù„Ùˆ Ø§Ù„ÙŠÙˆØ²Ø± Ø¯Ø®Ù„ Ø¹Ù„ÙŠ Ø±ÙˆØª Ù…Ø´ Ù…ØªØ¹Ø±Ù. ğŸ‘‡

app.all('*', (req, res, next) => {
	next(new AppError(`Can't find ${req.originalUrl} on this server`, 404));
});

18 - Ø¨Ø³ØªØ®Ø¯Ù… Ø§Ù„ errorHandler. ğŸ‘‡

app.use(errorHandler);

19 - Ø§Ø®Ø± Ø­Ø§Ø¬Ù‡ Ø¨Ø¹Ù…Ù„ export Ù„Ù„ app Ø¹Ù„Ø´Ø§Ù† Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ù Ø§Ù„ server. ğŸ‘‡

module.exports = app;
